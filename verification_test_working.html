<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Species Verification - Listening Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1f3a;
            color: #e0e0e0;
            padding: 30px;
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 {
            font-size: 2.5em;
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 40px;
        }
        .species-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }
        .species-name {
            font-size: 1.8em;
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .info {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .media-section {
            background: rgba(0, 212, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .media-section h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }
        img {
            max-width: 100%;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            border: 2px solid rgba(0, 212, 255, 0.3);
        }
        img:hover {
            border-color: #00d4ff;
        }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .decision-buttons {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }
        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        button:hover { transform: scale(1.05); }
        .btn-accept { background: #00ff88; color: #000; }
        .btn-reject { background: #ff6b6b; color: #fff; }
        .btn-uncertain { background: #ffa500; color: #fff; }
        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            font-family: inherit;
            margin-top: 10px;
            min-height: 60px;
        }
        .saved {
            background: rgba(0, 255, 136, 0.2);
            border: 2px solid #00ff88;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Species Verification - Listening Test</h1>

        <!-- 1. BAR-HEADED GOOSE -->
        <div class="species-card" id="barheaded">
            <div class="species-name">1. Bar-headed Goose (LIKELY ESCAPE)</div>
            <div class="info">
                <strong>Detections:</strong> 1<br>
                <strong>Issue:</strong> Asian species, natural range Central/South Asia<br>
                <strong>Recommendation:</strong> REJECT unless clearly wild population
            </div>
            <div class="media-section">
                <h3>üì∏ Spectrogram</h3>
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251013_113753_Bar-headed_Goose_10605s_conf0826.png"
                     onclick="window.open(this.src)" alt="Bar-headed Goose spectrogram">
                <h3>üîä Audio</h3>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-13_11h37m_Bar-headed_Goose_10605s_conf0826.mp3" type="audio/mpeg">
                    <source src="results/audio_clips_enhanced/2025-10-13_11h37m_Bar-headed_Goose_10605s_conf0826.wav" type="audio/wav">
                </audio>
            </div>
            <div class="decision-buttons">
                <button class="btn-accept" onclick="saveDecision('barheaded', 'ACCEPT')">‚úì ACCEPT</button>
                <button class="btn-reject" onclick="saveDecision('barheaded', 'REJECT')">‚ùå REJECT</button>
                <button class="btn-uncertain" onclick="saveDecision('barheaded', 'UNCERTAIN')">‚ùì UNCERTAIN</button>
            </div>
            <textarea placeholder="Your notes..."></textarea>
            <div class="saved"></div>
        </div>

        <!-- 2. RICHARD'S PIPIT -->
        <div class="species-card" id="richardspipit">
            <div class="species-name">2. Richard's Pipit (LIKELY VALID ‚úì)</div>
            <div class="info">
                <strong>Detections:</strong> 1<br>
                <strong>Status:</strong> Regular vagrant to Scandinavia, peak October<br>
                <strong>Recommendation:</strong> ACCEPT - timing is perfect
            </div>
            <div class="media-section">
                <h3>üì∏ Spectrogram</h3>
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251014_000000_Richard's_Pipit_30885s_conf0940.png"
                     onclick="window.open(this.src)" alt="Richard's Pipit spectrogram">
                <h3>üîä Audio</h3>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Richard's_Pipit_30885s_conf0940.mp3" type="audio/mpeg">
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Richard's_Pipit_30885s_conf0940.wav" type="audio/wav">
                </audio>
            </div>
            <div class="decision-buttons">
                <button class="btn-accept" onclick="saveDecision('richardspipit', 'ACCEPT')">‚úì ACCEPT</button>
                <button class="btn-reject" onclick="saveDecision('richardspipit', 'REJECT')">‚ùå REJECT</button>
                <button class="btn-uncertain" onclick="saveDecision('richardspipit', 'UNCERTAIN')">‚ùì UNCERTAIN</button>
            </div>
            <textarea placeholder="Your notes..."></textarea>
            <div class="saved"></div>
        </div>

        <!-- 3. RIVER WARBLER -->
        <div class="species-card" id="riverwarbler">
            <div class="species-name">3. River Warbler (RARE - HIGH VALUE IF REAL)</div>
            <div class="info">
                <strong>Detections:</strong> 1<br>
                <strong>Status:</strong> Very rare vagrant to western Europe<br>
                <strong>Recommendation:</strong> Careful review - valuable sighting if verified
            </div>
            <div class="media-section">
                <h3>üì∏ Spectrogram</h3>
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251014_000000_River_Warbler_26664s_conf0254.png"
                     onclick="window.open(this.src)" alt="River Warbler spectrogram">
                <h3>üîä Audio</h3>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_River_Warbler_26664s_conf0254.mp3" type="audio/mpeg">
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_River_Warbler_26664s_conf0254.wav" type="audio/wav">
                </audio>
            </div>
            <div class="decision-buttons">
                <button class="btn-accept" onclick="saveDecision('riverwarbler', 'ACCEPT')">‚úì ACCEPT</button>
                <button class="btn-reject" onclick="saveDecision('riverwarbler', 'REJECT')">‚ùå REJECT</button>
                <button class="btn-uncertain" onclick="saveDecision('riverwarbler', 'UNCERTAIN')">‚ùì UNCERTAIN</button>
            </div>
            <textarea placeholder="Your notes..."></textarea>
            <div class="saved"></div>
        </div>

        <!-- 4. ARCTIC WARBLER (4 detections) -->
        <div class="species-card" id="arcticwarbler">
            <div class="species-name">4. Arctic Warbler (4 DETECTIONS)</div>
            <div class="info">
                <strong>Detections:</strong> 4<br>
                <strong>Status:</strong> Rare in western Norway<br>
                <strong>Recommendation:</strong> Review all 4 for consistency - could be real passage or misID
            </div>
            <div class="media-section">
                <h3>üì∏ Spectrograms (4 detections)</h3>
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251014_000000_Arctic_Warbler_26025s_conf0419.png"
                     onclick="window.open(this.src)" alt="Arctic Warbler 1">
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251014_000000_Arctic_Warbler_29232s_conf0462.png"
                     onclick="window.open(this.src)" alt="Arctic Warbler 2">
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251014_000000_Arctic_Warbler_29391s_conf0415.png"
                     onclick="window.open(this.src)" alt="Arctic Warbler 3">

                <h3>üîä Audio Files</h3>
                <p><strong>Detection 1:</strong></p>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Arctic_Warbler_26025s_conf0419.wav" type="audio/wav">
                </audio>
                <p><strong>Detection 2:</strong></p>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Arctic_Warbler_29232s_conf0462.wav" type="audio/wav">
                </audio>
                <p><strong>Detection 3:</strong></p>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Arctic_Warbler_29391s_conf0415.wav" type="audio/wav">
                </audio>
                <p><strong>Detection 4:</strong></p>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Arctic_Warbler_30708s_conf0300.wav" type="audio/wav">
                </audio>
            </div>
            <div class="decision-buttons">
                <button class="btn-accept" onclick="saveDecision('arcticwarbler', 'ACCEPT ALL')">‚úì ACCEPT ALL 4</button>
                <button class="btn-reject" onclick="saveDecision('arcticwarbler', 'REJECT ALL')">‚ùå REJECT ALL 4</button>
                <button class="btn-uncertain" onclick="saveDecision('arcticwarbler', 'SOME')">‚ö†Ô∏è ACCEPT SOME</button>
            </div>
            <textarea placeholder="Your notes (specify which to accept if SOME)..."></textarea>
            <div class="saved"></div>
        </div>

        <!-- 5. WESTERN CAPERCAILLIE -->
        <div class="species-card" id="capercaillie">
            <div class="species-name">5. Western Capercaillie (HABITAT MISMATCH)</div>
            <div class="info">
                <strong>Detections:</strong> 1<br>
                <strong>Issue:</strong> Forest grouse, not wetland bird<br>
                <strong>Possible:</strong> Broods use forests near peat bogs - check if forest edge nearby
            </div>
            <div class="media-section">
                <h3>üì∏ Spectrogram</h3>
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251014_122526_Western_Capercaillie_40806s_conf0272.png"
                     onclick="window.open(this.src)" alt="Western Capercaillie spectrogram">
                <h3>üîä Audio</h3>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_12h25m_Western_Capercaillie_40806s_conf0272.mp3" type="audio/mpeg">
                    <source src="results/audio_clips_enhanced/2025-10-14_12h25m_Western_Capercaillie_40806s_conf0272.wav" type="audio/wav">
                </audio>
            </div>
            <div class="decision-buttons">
                <button class="btn-accept" onclick="saveDecision('capercaillie', 'ACCEPT')">‚úì ACCEPT</button>
                <button class="btn-reject" onclick="saveDecision('capercaillie', 'REJECT')">‚ùå REJECT</button>
                <button class="btn-uncertain" onclick="saveDecision('capercaillie', 'UNCERTAIN')">‚ùì UNCERTAIN</button>
            </div>
            <textarea placeholder="Your notes..."></textarea>
            <div class="saved"></div>
        </div>

        <!-- 6. BLACK-LEGGED KITTIWAKE -->
        <div class="species-card" id="kittiwake">
            <div class="species-name">6. Black-legged Kittiwake (STORM-DRIVEN?)</div>
            <div class="info">
                <strong>Detections:</strong> 1<br>
                <strong>Issue:</strong> Coastal/oceanic gull, rare inland<br>
                <strong>Check:</strong> Was there a storm Oct 13-15? If yes, plausible. If no, reject.
            </div>
            <div class="media-section">
                <h3>üì∏ Spectrogram</h3>
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251015_000000_Black-legged_Kittiwake_25818s_conf0320.png"
                     onclick="window.open(this.src)" alt="Black-legged Kittiwake spectrogram">
                <h3>üîä Audio</h3>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-15_00h00m_Black-legged_Kittiwake_25818s_conf0320.mp3" type="audio/mpeg">
                    <source src="results/audio_clips_enhanced/2025-10-15_00h00m_Black-legged_Kittiwake_25818s_conf0320.wav" type="audio/wav">
                </audio>
            </div>
            <div class="decision-buttons">
                <button class="btn-accept" onclick="saveDecision('kittiwake', 'ACCEPT')">‚úì ACCEPT (storm)</button>
                <button class="btn-reject" onclick="saveDecision('kittiwake', 'REJECT')">‚ùå REJECT (no storm)</button>
                <button class="btn-uncertain" onclick="saveDecision('kittiwake', 'UNCERTAIN')">‚ùì UNCERTAIN</button>
            </div>
            <textarea placeholder="Your notes..."></textarea>
            <div class="saved"></div>
        </div>

        <!-- 7. CORN CRAKE -->
        <div class="species-card" id="corncrake">
            <div class="species-name">7. Corn Crake (SECRETIVE - HIGH VALUE)</div>
            <div class="info">
                <strong>Detections:</strong> 1<br>
                <strong>Status:</strong> Declining, secretive species<br>
                <strong>Recommendation:</strong> Review call pattern - distinctive rasping. Valuable if real.
            </div>
            <div class="media-section">
                <h3>üì∏ Spectrogram</h3>
                <img src="results/spectrograms_best/245AAA0563ED3DA7_20251014_000000_Corn_Crake_26580s_conf0272.png"
                     onclick="window.open(this.src)" alt="Corn Crake spectrogram">
                <h3>üîä Audio</h3>
                <audio controls>
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Corn_Crake_26580s_conf0272.mp3" type="audio/mpeg">
                    <source src="results/audio_clips_enhanced/2025-10-14_00h00m_Corn_Crake_26580s_conf0272.wav" type="audio/wav">
                </audio>
            </div>
            <div class="decision-buttons">
                <button class="btn-accept" onclick="saveDecision('corncrake', 'ACCEPT')">‚úì ACCEPT</button>
                <button class="btn-reject" onclick="saveDecision('corncrake', 'REJECT')">‚ùå REJECT</button>
                <button class="btn-uncertain" onclick="saveDecision('corncrake', 'UNCERTAIN')">‚ùì UNCERTAIN</button>
            </div>
            <textarea placeholder="Your notes..."></textarea>
            <div class="saved"></div>
        </div>

        <div style="background: rgba(0, 212, 255, 0.1); padding: 30px; border-radius: 15px; margin-top: 40px; text-align: center;">
            <h2 style="color: #00d4ff;">Summary of Decisions</h2>
            <button onclick="exportDecisions()" style="background: linear-gradient(135deg, #00d4ff, #7b2ff7); margin-top: 20px;">
                üì• Export Decisions to File
            </button>
            <div id="summary" style="margin-top: 20px; font-size: 1.1em;"></div>
        </div>
    </div>

    <script>
        function saveDecision(species, decision) {
            const card = document.getElementById(species);
            const notes = card.querySelector('textarea').value;
            const saved = card.querySelector('.saved');

            const data = {
                species: species,
                decision: decision,
                notes: notes,
                timestamp: new Date().toISOString()
            };

            // Save to localStorage
            const allData = JSON.parse(localStorage.getItem('speciesVerification') || '{}');
            allData[species] = data;
            localStorage.setItem('speciesVerification', JSON.stringify(allData));

            // Show saved message
            saved.textContent = `‚úì Saved: ${decision}`;
            saved.style.display = 'block';
            setTimeout(() => { saved.style.display = 'none'; }, 3000);

            updateSummary();
        }

        function updateSummary() {
            const data = JSON.parse(localStorage.getItem('speciesVerification') || '{}');
            const summary = document.getElementById('summary');

            let html = '<div style="text-align: left; max-width: 600px; margin: 0 auto;">';
            Object.keys(data).forEach(species => {
                const color = data[species].decision.includes('ACCEPT') ? '#00ff88' :
                              data[species].decision.includes('REJECT') ? '#ff6b6b' : '#ffa500';
                html += `<div style="padding: 10px; margin: 5px 0; background: rgba(0,0,0,0.3); border-left: 4px solid ${color};">
                    <strong>${species}:</strong> ${data[species].decision}
                </div>`;
            });
            html += '</div>';
            summary.innerHTML = html;
        }

        function exportDecisions() {
            const data = localStorage.getItem('speciesVerification');
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `species_verification_decisions_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            alert('‚úì Decisions exported! Save the file for your records.');
        }

        // Load on page start
        window.addEventListener('load', updateSummary);
    </script>
</body>
</html>
